## Chapter 4 데이터베이스

### 1. 데이터베이스의 기본

- DBMS(DataBase Management System): 데이터베이스를 제어, 관리하는 통합 시스템
- 엔터티(entity): 사람, 장소, 물건, 사건, 개념 등 여러 개의 속성을 지닌 명사
  - 회원 엔터티: 이름, 아이디, 주소, 전화번호의 속성을 가짐
  - 약한 엔터티
  - 강한 엔터티

#### 릴레이션(relation)

- 데이터베이스에서 정보를 구분하여 저장하는 기본 단위

#### 속성(attribute)

- 릴레이션에서 관리하는 구체적이며 고유한 이름을 갖는 정보

#### 도메인(domain)

- 릴레이션에 포함된 각각의 속성들이 가질 수 있는 값의 집합

#### 관계

- 1:1 관계
- 1:N 관계

- N:M 관계

#### 키

- 기본키(Primary Key): PK, 유일성 최소성 만족
  - 자연키: 언젠가 변하는 속성
  - 인조키: 인위적으로 생성한 키
- 외래키(Foreign Key): FK, 다른테이블의 기본키를 그대로 참조하는 값으로 개체와의 관계를 식별하는 데 사용. 중복 가능
- 후보키(candidate key): 기본키가 될 수 있는 후보들. 유일성 최소성을 동시에 만족
- 슈퍼키(super key): 각 레코드를 유일하게 식별할 수 있는 유일성을 갖춘 키
- 대체키(alternate key): 후보키가 두 개 이상일 경우 어느 하나를 기본키로 지정하고 남은 후보키

### ERD와 정규화 과정

#### ERD의 중요성

- ERD는 시스템의 요구 사항을 기반으로 작성되며 이 ERD를 기반으로 데이터베이스를 구축함
- 데이터베이스 구축 이후에도 디버깅 또는 비즈니스 프로세스 재설계 시 설계도 역할 담당
- ERD는 관계형 구조로 표현할 수 있는 데이터를 구성하는 데 유용할 수 있지만 비정형 데이터를 충분히 표현할 수 없다는 단점.

#### 정규화 과정

- 릴레이션 간의 잘못된 종속 관계로 인해 데이터베이스 이상 현상이 일어나서 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정
- 제1정규형: 릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자 값(atomic value)만으로 구성되어야 함
  - 반복 집합 제거
- 제2정규형: 릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태
  - 주의: 릴레이션을 분해할 때 동등한 릴레이션으로 분해해야 하고, 정보 손실이 발생하지 않는 무손실 분해로 분해되어야 함
- 제3정규형: 제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)을 만족하지 않는 상태
  - 이행적 함수 종속: A → B와 B → C가 존재하면 논리적으로 A → C가 성립하는데, 이때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 함

- 보이스/코드 정규형(BCNF): 제3정규형, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태

#### 트랜잭션과 무결성

#### 트랜잭션

- 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위. 여러 개의 쿼리들을 하나로 묶는 단위
- 원자성(atomicity): 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징
- 일관성(consistency): ‘허용된 방식’으로만 데이터를 변경해야 하는 것. 데이터베이스에 기록된 모든 데이터는 여러 가지 조건, 규칙에 따라 유효함을 가져야 함
- 독립성(isolation): 트랜잭션 수행 시 서로 끼어들지 못하는 것. 복수의 병렬 트랜잭션은 서로 격리 되어 마치 순차적으로 실행되는 것처럼 작동되어야 하고, 데이터베이스는 여러 사용자가 같은 데이터에 접근할 수 있어야 함
  - 격리 수준: 
    - SERIALIZABLE: 강한 격리성, 약한 동시성. 트랜잭션을 순차적으로 진행시키는 것
    - REPEATABLE_READ
    - READ_COMMITTED: 가장 많이 사용되는 격리 수준
      - 커밋 완료된 데이터에 대해서만 조회를 허용: READ_UNCOMMITTED와는 달리 다른 트랜잭션이 커밋하지 않은 정보는 읽을 수 없음
    - READ_UNCOMMITTED: 약한 동시성, 강한 격리성
      - 가장 낮은 격리 수준으로, 하나의 트랜잭션이 커밋되기 이전에 다른 트랜잭션에 노 출되는 문제가 있지만 가장 빠름
  - 격리 수준에 따라 발생하는 현상
    - 팬텀 리드: 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우
    - 반복 가능하지 않은 조회:  트랜잭션 내의 같은 행에 두 번 이상 조회가 발생했는데, 그 값이 다른 경우
      - 반복 가능하지 않은 조회는 행 값이 달라질 수도 있는데, 팬텀 리드는 다른 행이 선택될 수도 있음
    - 더티 리드: 반복 가능하지 않은 조회와 유사하며 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 수정되었지만 아직 ‘커밋되지 않은’ 행의 데이터를 읽을 수 있을 때 발생
- 지속성(durability): 성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 것
  - 데이터베이스에 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 함
  - 데이터베이스에서 체크섬(중복 검사), 저널링(변경사항 로깅), 롤백 기능 제공

#### 무결성

- 데이터의 정확성, 일관성, 유효성을 유지하는 것
- 무결성이 유지되어야 데이터베이스 저장된 데이터값, 실제값이 일치하는지에 대한 신뢰가 생김
- 무결성의 종류
  - 개체 무결성: 기본키로 선택된 필드는 빈 값을 허용하지 않음
  - 참조 무결성: 서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값을 유지해야 함
  - 고유 무결성: 특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가짐
  - NULL 무결성: 특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL이 될 수 없다는 제약 조건

