### 7.2 함수적 종속성

- 함수적 종속성의 개요
  - 정규화 이론의 핵심
  - 릴레이션의 애트리뷰트들의 의미로부터 결정됨
  - 릴레이션 스키마에 대한 주장이지, 릴레이션의 특정 인스턴스에 대한 주장이 아님
  - 릴레이션의 가능한 모든 인스턴스들이 만족해야 함
  - 실세계에 대한 지식과 응용의 의미를 기반으로 어떤 함수적 종속성들이 존재하는가를 파악해야 함
  - 함수적 종속성은 제2정규형부터 BCNF까지 적용됨
- 결정자(determinant)
  - 어떤 애트리뷰트의 값은 다른 애트리뷰트의 값을 고유하게 결정할 수 있음
  - 그림 7.4의 사원 릴레이션에서 사원번호는 사원이름을 고유하게 결정함
  - 주소는 사원이름을 고유하게 결정하지 못함
  - 결정자는 주어진 릴레이션에서 다른 애트리뷰트(또는 애트리뷰트들의 집합)를 고유하게 결정하는 하나 이상의 애트리뷰트를 의미
  - 결정자를 아래와 같이 표기하고, 이를 "A가 B를 결정한다" (또는 "A는 B의 결정자이다")라고 말함
- 함수적 종속성
  - 만일 애트리뷰트 A가 애트리뷰트 B의 결정자이면 B가 A에 함수적으로 종속한다고 말함
  - 다른 말로 표현하면, 주어진 릴레이션 R에서 애트리뷰트 B가 애트리뷰트 A에 함수적으로 종속하는 필요 충분 조건은 각 A 값에 대해 반드시 한 개의 B 값이 대응된다는 것
- 이행적 함수적 종속성(transitive FD)
  - 한 릴레이션의 애트리뷰트 A, B, C가 주어졌을 때 애트리뷰트 C가 이행적으로 A에 종속한다(A-> C)는 것의 필요 충분 조건은 A->B 교집합 B->C가 성립하는 것
  - A가 릴레이션의 기본 키라면 키의 정의에 따라 A->B와 A->C가 성립. 만일 C가 A외에 B에도 함수적으로 종속한다면 C는 A에 직접 함수적으로 종속하면서 B를 거쳐서 A에 이행적으로 종속

### 7.3 릴레이션의 분해 (decomposition)

- 릴레이션 분해
  - 하나의 릴레이션을 두 개 이상의 릴레이션으로 나누는 것
  - 릴레이션을 분해하면 중복이 감소되고 갱신 이상이 줄어드는 장점이 있는 반면에, 바람직하지 않은 문제들을 포함하여 몇 가지 잠재적인 문제들을 야기할 수 있음
    - 릴레이션이 분해되기 전에는 조인이 필요 없는 질의가 분해 후에는 조인을 필요로 하는 질의로 바뀔 수 있음
    - 분해된 릴레이션들을 사용하여 원래 릴레이션을 재구성하지 못할 수 있음
- 무손실 분해(lossless decomposition)
  - 분해된 두 릴레이션을 조인하면 원래의 릴레이션에 들어 있는 정보를 완전하게 얻을 수 있음
  - 여기서 손실이란 정보의 손실을 뜻함
  - 정보의 손실은 원래의 릴레이션을 분해한 후에 생성된 릴레이션들을 조인한 결과에 들어 있는 정보가 원래의 릴레이션에 들어 있는 정보보다 적거나 많은 것을 모두 포함

### 7.4 제1정규형, 제2정규형, 제3정규형, BCNF

- 제1정규형
  - 한 릴레이션 R이 제 1정규형을 만족할 필요 충분 조건은 릴레이션 R의 모든 애트리뷰트가 원자값만을 갖는다는 것
  - 즉 릴레이션의 모든 애트리뷰트에 반복 그룹(repeating group)이 나타나지 않으면 제1정규형을 만족함
- 제2정규형
  - 한 릴레이션 R이 제2정규형을 만족할 필요 충분 조건은 릴레이션 R이 제1정규형을 만족하면서, 어떤 후보 키에도 속하지 않는 모든 애트리뷰트들이 R의 기본 키에 완전하게 함수적으로 종속하는 것
  - 기본 키가 두 개 이상의 애트리뷰트로 구성되었을 경우에만 제 1정규형이 제2정규형을 만족하는가를 고려할 필요가 없음
- 제3정규형
  - 한 릴레이션 R이 제3정규형을 만족할 필요 충분 조건은 릴레이션 R이 제2정규형을 만족하면서, 키가 아닌 모든 애트리뷰트가 릴레이션 R의 기본키에 이행적으로 종속하지 않는 것
- BCNF
  - 한 릴레이션 R이 BCNF를 만족할 필요 충분 조건은 릴레이션 R이 제3정규형을 만족하고, 모든 결정자가 후보 키이어야 함
  - 위의 수강 릴레이션에서 강사 애트리뷰트는 후보 키가 아님에도 불구하고 과목 애트리뷰트를 결정하기 때문에 BCNF가 아님
  - 제3정규형을 만족하는 대부분의 릴레이션 BCNF도 만족함
  - 하나의 후보 키만을 가진 릴레이션이 제3정규형을 만족하면 동시에 BCNF도 만족함
  - 제3정규형을 만족하는 릴레이션을 BCNF으로 정규화하려면 키가 아니면서 결정자 역할을 하는 애트리뷰트와 그 결정자에 함수적으로 종속하는 애트리뷰트를 하나의 테이블에 넣음. 이 릴레이션에서 결정자는 기본 키가 됨
  - 그 다음에는 기존 릴레이션에 결정자를 남겨서 기본 키의 구성요소가 되도록 함. 또한 이 결정자는 새로운 릴레이션에 대한 외래키 역할도 함

### 7.5 역정규화

- 역정규화
  - 정규화 단계가 진행될수록 중복이 감소하고 갱신 이상도 감소됨
  - 정규화가 진전될수록 무결성 제약조건을 시행하기 위해 필요한 코드의 양도 감소됨
  - 정규화가 데이터베이스 설계의 중요한 요소이지만 성능상의 관점에서만 보면 높은 정규형을 만족하는 릴레이션 스키마가 최적인 것은 아님
  - 한 정규형에서 다음 정규형으로 진행될 때마다 하나의 릴레이션이 최소한 두 개의 릴레이션으로 분해됨
  - 분해되기 전의 릴레이션을 대상으로 질의를 할 때는 조인이 필요 없지만 분해된 릴레이션을 대상으로 질의를 할 때는 같은 정보를 얻기 위해서 보다 많은 릴레이션들을 접근해야 하므로 조인의 필요성이 증가함
  - 때로 데이터베이스 설계자는 응용의 요구 사항에 따라 데이터베이스 설계의 일부분을 역정규화함으로써 데이터 중복 및 갱신 이상을 대가로 치르면서 성능상의 요구를 만족시키기도 함
  - 많은 데이터베이스 응용에서 검색 질의의 비율이 갱신 질의의 비율보다 훨씬 높음. 역정규화는 주어진 응용에서 빈번하게 수행되는 검색 질의들의 수행 속도를 높이기 위해서 이미 분해된 두 개 이상의 릴레이션들을 합쳐서 하나의 릴레이션으로 만드는 작업
  - 즉 역정규화는 보다 낮은 정규형으로 되돌아가는 것

---

## 8. 뷰와 시스템 카탈로그

- 뷰와 시스템 카탈로그
  - 관계 데이터베이스 시스템의 뷰(view)는 다른 릴레이션으로부터 유됴된 릴레이션(derived relation)으로서 ANSI/SPARC 3단계 아키텍쳐의 외부 뷰와 다름
  - 뷰는 관계 데이터베이스 시스템에서 데이터베이스의 보안 매카니즘으로서, 복잡한 질의를 간단하게 표현하는 수단으로서, 데이터독립성을 높이기 위해서 사용됨
  - 시스템 카탈로그는 시스템내의 객체(기본 릴레이션, 뷰, 인덱스, 사용자, 접근 권한 등)에 관한 정보를 포함
  - 시스템 카탈로그를 적절히 활용하면 원하는 릴레이션을 데이터베이스에서 찾고, 그 릴레이션에 어떤 애트리뷰트들이 들어 있으며, 각 애트리뷰트의 데이터타입은 무엇인가 등을 쉽게 파악할 수 있음



### 8.1 뷰

- 뷰의 개요

  - ANSI/SPARC 3단계 아키텍처에서 외부 뷰는 특정 사용자가 보는 데이터베이스의 구조
  - 관계 데이터베이스에서의 뷰는 한 사용자의 전체 외부 뷰 대신에 하나의 가상 릴레이션(virtual relation)을 의미
  - 뷰는 기존의 기본 릴레이션(base relation. 실제 릴레이션)에 대한 SELECT문의 형태로 정의됨
  - 사용자는 여러 개의 릴레이션과 뷰를 사용할 수 없음
  - 뷰는 릴레이션으로부터 데이터를 검색하거나 갱신할 수 있는 동적인 창(dynamic window)의 역할

- 스냅샷(snapshot)

  - 어느 시점에 SELECT문의 결과를 기본 릴레이션의 형태로 저장해 놓은 것
  - 스냅샷은 사진을 찍은 것과 같아서 스냅샷을 정의하는 시점의 기본 릴레이션의 내용이 스냅샷에 반영됨
  - 어떤 시점의 조직체의 현황, 예를 들어 몇년 몇월 시점에 근무하던 사원들의 정보, 재고 정보 등이 스냅샷으로 정의될 수 있음

- 뷰의 정의

  - 뷰를 정의하는 SQL문의 구문

    CREATE VIEW 뷰이름 [(애트리뷰트 (들))]

    AS SELECT문

    [WITH CHECK OPTION];

  - 뷰의 이름 다음에 애트리뷰트들을 생략하면 뷰를 정의하는데 사용된 SELECT문의 SELECT절에 열거된 애트리뷰트들의 이름과 동일한 애트리뷰트들이 뷰에 포함됨

  - 뷰를 정의하는 SELECT절에 산술식 또는 집단 함수에 사용된 애트리뷰트가 있는 경우, 뷰의 정의에 조인이 포함되어 있고 두 개 이상의 다른 릴레이션으로부터 가져온 애트리뷰트들의 이름이 같아서 뷰에서 두 개 이상의 애트리뷰트의 이름이 같게 되는 경우에는 뷰를 정의할 때 모든 애트리뷰트들의 이름을 지정해야 함

- 뷰를 사용하여 데이터를 접근할 때 관계 DBMS에서 거치는 과정

  - 시스템 카탈로그로부터 뷰의 정의, 즉 SELECT문을 검색
  - 기본 릴레이션에 대한 뷰의 접근 권한을 검사
  - 뷰에 대한 질의를 기본 릴레이션에 대한 동등한 질의로 변환

- 뷰의 장점
  - 뷰는 데이터를 무결성으로 보장하는데 활용됨
  - 뷰는 데이터 독립성을 제공함
    - 뷰는 데이터베이스의 구조가 바뀌어도 기존의 질의(응용 프로그램)를 다시 작성할 필요성을 줄이는데 사용될 수 있음
  - 뷰는 데이터 보안 기능을 제공함
    - 뷰는 뷰의 원본이 되는 기본 릴레이션에 직접 접근할 수 있는 권한을 부여하지 않고 뷰를 통해 데이터를 접근하도록 하기 때문에 보안 매커니즘으로 사용할 수 있음
    - 뷰는 일반적으로 기본 릴레이션의 일부 애트리뷰트들 또는 일부 튜플들을 검색하는 SELECT문으로 정의되므로 뷰를 통해서 기본 릴레이션을 접근하면 기본 릴레이션의 일부만 검색할 수 있음
  - 동일한 데이터에 대한 여러 가지 뷰를 제공함
    - 뷰는 사용자들의 그룹이 각자 특정한 기준에 따라 데이터를 접근하도록 함
- 뷰의 갱신
  - 뷰에 대한 갱신도 기본 릴레이션에 대한 갱신으로 변환됨
- 갱신이 불가능한 뷰
  - 한 릴레이션 위에서 정의되었으나 그 릴레이션의 기본 키가 포함되지 않은 뷰
  - 기본 릴레이션의 애트리뷰트들 중에서 뷰에 포함되지 않은 애트리뷰트에 대해 NOT NULL이 지정되어 있을 때
  - 집단 함수가 포함된 뷰
  - 조인으로 정의된 뷰



### 8.2 관계 DBMS의 시스템 카탈로그

- 시스템 카탈로그
  - 시스템 카탈로그는 데이터베이스의 객체(사용자, 릴레이션, 뷰, 인덱스, 권한 등)와 구조들에 관한 모든 데이터를 포함
  - 시스템 카탈로그를 메타데이터라고 함. 메타데이터는 데이터에 관한 데이터라는 의미
  - 시스템 카탈로그는 사용자 및 질의 최적화 모듈 등 DBMS 자신의 구성요소에 의해서 사용됨
  - 시스템 카탈로그는 관계 DBMS마다 표준화되어 있지 않아서 관계 DBMS마다 서로 다른 형태로 시스템 카탈로그 기능을 제공함
  - 시스템 카탈로그는 데이터 사전(data dictionary) 또는 시스템 테이블 이라고도 부름

- 관계 DBMS의 시스템 카탈로그
  - 사용자 릴레이션과 마찬가지 형태로 저장되기 때문에 사용자 릴레이션에 적용되는 회복 기법과 동시성 제어 기법을 동일하게 사용할 수 있음
  - 시스템 카탈로그는 사용자 릴레이션처럼 SELECT문을 사용하여 내용을 검색할 수 있음
  - 시스템 카탈로그에는 릴레이션, 애트리뷰트,  인덱스, 사용자, 권한 등 각 유형마다 별도의 릴레이션이 유지됨
  - EMPLOYEE 릴레이션과 DEPARTMENT 릴레이션에 대해서 시스템 카탈로그에 어떤 정보들이 유지되는가를 이해하기 쉽도록 시스템 카탈로그를 매우 단순화하여 설명함
- 시스템 카탈로그의 갱신
  - 어떤 사용자도 시스템 카탈로그를 직접 갱신할 수 없음
  - 즉, DELETE, UPDATE 또는 INSERT문을 사용하여 시스템 카탈로그를 변경할 수 없음



### 8.3 SQL Server의 시스템 카탈로그

- MS SQL Server의 시스템 카탈로그
  - 통계 정보는 UPDATE STATISTICS문을 사용하여 수동으로 갱신할 수 있음
  - SQL Server는 릴레이션의 데이터가 변경될 때 주기적으로 통계 정보를 자동으로 갱신함
  - 통계 정보를 갱신할 필요성이 있는가를 확인하기 위해서 샘플링 방법을 사용함
  - 통계 정보가 생신되는 빈도는 애트리뷰트 또는 인덱스의 크기와 변경되는 데이터의 양에 따라 결정됨
  - 모든 릴레이션들에 대한 구성을 정의하는 데이터를 시스템 테이블이라고 부르는 특수한 테이블 집합에 저장함
  - 사용자나 응용 프로그램이 정보 스키마 뷰, Transact-SQL문 및 함수, 시스템 저장 프로시저 등을 사용하여 시스템 테이블에 저장된 정보를 검색함